## CVE-2025-58360: GeoServer XXE

1 Tổng quan

- CVE-2025-58360 là lỗ hổng XXE không xác thực trong GeoServer OWS/WMS.

- Phiên bản ảnh hưởng: <= 2.25.5, 2.26.0-2.26.1.

- Cho phép kẻ tấn công: liệt kê thư mục, đọc tệp bất kỳ trên server (file://)

- Nguyên nhân: SLDParser.parseSLD() trong GeoServer xử lý XML mà không sử dụng EntityResolver, dẫn đến việc XXE có thể được phân giải khi gửi StyledLayerDescriptor.

2 Build lab

- Khởi chạy docker: `docker-compose up -d`

- Cấu hình ports: Vulnerable: 8082

- Sử dụng script Python (CVE-2025-58360.py) để gửi payload XXE.

- Xác thực bằng trình duyệt: http://localhost:8082/geoserver/web/ (admin/geoserver)

<img width="1390" height="975" alt="image" src="https://github.com/user-attachments/assets/4292bf30-a5b8-4ed8-bd28-18944ebed90a" />

3 Demo exploit

- Sử dụng CVE-2025-58360.py để đọc file /etc/passwd: `python CVE-2025-58360.py -u http://localhost:8082 --file /etc/passwd`

<img width="847" height="659" alt="image" src="https://github.com/user-attachments/assets/b7248559-6f8c-46f0-9482-eebb74a71d8e" />

- Nguyên lý hoạt động:

1. Script gửi SLD XML có khai báo `<!ENTITY xxe SYSTEM "file:///etc/passwd">`.

2. Parser GeoServer không chặn entity, thay thế `&xxe;` bằng nội dung file.

3. Khi GeoServer cố dùng giá trị entity làm layer name, lỗi “Unknown layer” echo lại nội dung file.

4. Script nhận phản hồi, trích xuất nội dung file.

4 Phân tích

Lỗ hổng xuất phát từ việc phương thức SLDParser.parseSLD() của GeoServer xử lý các tài liệu StyledLayerDescriptor (SLD) mà không áp dụng các hạn chế phân giải XML entity phù hợp. Mặc dù OWS Dispatcher đã cấu hình AllowListEntityResolver để ngăn chặn XXE, đường dẫn xử lý SLD thông qua SLDXmlRequestReader và SLDHandler.parse() lại tạo XML parser riêng, bỏ qua lớp bảo vệ này. Do đó, các external entity được khai báo trong SLD XML vẫn được phân giải, dẫn đến khả năng đọc tệp cục bộ hoặc thực hiện SSRF.
