##  CVE‑2020‑23127

1 Tổng quan

- CVE‑2020‑23127 là một lỗ hổng Cross‑Site Request Forgery (CSRF) cho phép kẻ tấn công thực hiện hành động thay đổi quyền người dùng khi nạn nhân đã đăng nhập, mà không cần xác thực thêm.

- Loại lỗ hổng: CSRF (OWASP A01:2021 – Broken Access Control)

- Tác động: Privilege Escalation (leo thang đặc quyền)

- Nguyên nhân cốt lõi: Endpoint nhạy cảm (user_edit.php) không kiểm tra CSRF token, tin tưởng hoàn toàn vào session cookie,

- Điều kiện khai thác: nạn nhân (admin) đang đăng nhập, truy cập trang do attacker kiểm soát

2 Build Lab

- Docker + Docker Compose

- Hệ điều hành: Windows / Linux / macOS

- Chạy lab: docker compose up -d

- Sau khi hoàn tất: Ứng dụng nạn nhân: http://localhost:8081; Website attacker (CSRF payload): http://localhost:8082

3 Demo Exploit (Chứng minh khai thác)

B1: Đăng nhập admin

- Truy cập: http://localhost:8081

- Đăng nhập với quyền Administrator / Admin

B2: Kiểm tra trạng thái ban đầu

- Vào: Administration → Users → Users list. Quan sát user: Juan Hernandez với vai trò ban đầu: Student / Intern

B3: Kích hoạt tấn công CSRF

- Mở tab mới truy cập: http://localhost:8082. Trang này chứa form POST ẩn tự động gửi request: POST http://localhost:8081/main/admin/user_edit.php?user_id=3. Request này được gửi bằng session cookie của admin.

B4: Quan sát kết quả

- Quay lại localhost:8081

- Refresh trang danh sách user

Kết quả: Juan Hernandez đã bị đổi role từ Student → Teacher

4 Phân tích

- Cookie session tự động gửi theo request, CSRF token	Không tồn tại / không kiểm tra, method	POST nhưng không được bảo vệ, Authorization	Chỉ kiểm tra “đã đăng nhập”.

- Server không phân biệt request hợp lệ và request giả mạo.

- Tác động bảo mật: Thay đổi quyền người dùng, thêm admin giả, reset mật khẩu, toàn bộ hệ thống mất kiểm soát nếu admin truy cập link độc hại.
