1. Tổng quan CVE‑2020‑23127

CVE‑2020‑23127 là một lỗ hổng Cross‑Site Request Forgery (CSRF) cho phép kẻ tấn công thực hiện hành động thay đổi quyền người dùng khi nạn nhân đã đăng nhập, mà không cần xác thực thêm.

Đặc điểm chính

Loại lỗ hổng: CSRF (OWASP A01:2021 – Broken Access Control)

Tác động: Privilege Escalation (leo thang đặc quyền)

Nguyên nhân cốt lõi:

Endpoint nhạy cảm (user_edit.php) không kiểm tra CSRF token

Tin tưởng hoàn toàn vào session cookie

Điều kiện khai thác:

Nạn nhân (admin) đang đăng nhập

Truy cập trang độc hại do attacker kiểm soát

2. Build Lab (Dựng môi trường PoC)
2.1 Yêu cầu

Docker + Docker Compose

Hệ điều hành: Windows / Linux / macOS (Windows + Docker Desktop là đủ)

2.2 Cấu trúc thư mục

Ba file bắt buộc nằm cùng thư mục:

cve-2020-23127-lab/
├── compose.yaml
├── dump.sql
└── dump-updated.sql

2.3 Chạy lab

Tại thư mục trên:

docker compose up -d


Sau khi hoàn tất:

Ứng dụng nạn nhân: http://localhost:8081

Website attacker (CSRF payload): http://localhost:8082

3. Demo Exploit (Chứng minh khai thác)
Bước 1 – Đăng nhập admin

Truy cập: http://localhost:8081

Đăng nhập với quyền Administrator / Admin

Bước 2 – Kiểm tra trạng thái ban đầu

Vào:
Administration → Users → Users list

Quan sát user:

Juan Hernandez

Vai trò ban đầu: Student / Intern

Bước 3 – Kích hoạt tấn công CSRF

Mở tab mới

Truy cập: http://localhost:8082

Trang này chứa form POST ẩn tự động gửi request:

POST http://localhost:8081/main/admin/user_edit.php?user_id=3


➡️ Request này được gửi bằng session cookie của admin.

Bước 4 – Quan sát kết quả

Quay lại localhost:8081

Refresh trang danh sách user

Kết quả:

Juan Hernandez đã bị đổi role từ Student → Teacher

➡️ Không có cảnh báo
➡️ Không có xác nhận
➡️ Không có CSRF token

4. Phân tích kỹ thuật lỗ hổng
4.1 Vì sao khai thác được?
Yếu tố	Phân tích
Cookie session	Tự động gửi theo request
CSRF token	Không tồn tại / không kiểm tra
Method	POST nhưng không được bảo vệ
Authorization	Chỉ kiểm tra “đã đăng nhập”

➡️ Server không phân biệt request hợp lệ và request giả mạo.

4.2 Request CSRF (bản chất)

Trình duyệt nạn nhân gửi:

Cookie admin hợp lệ

POST request hợp lệ

Server tin tưởng tuyệt đối request đó

CSRF không bypass auth
CSRF lợi dụng auth có sẵn

4.3 Tác động bảo mật

Thay đổi quyền người dùng

Thêm admin giả

Reset mật khẩu

Toàn bộ hệ thống mất kiểm soát nếu admin truy cập link độc hại
